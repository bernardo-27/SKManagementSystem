<!doctype html>
<html lang="en">
	<head>
		<title>Sangguniang Kabataan Management System</title>
		<link rel="icon" href="sk.jpg" rounded>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/unicons/4.0.0/css/unicons.min.css">
		<link rel="stylesheet" href="style1.css">
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
		<link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">


	<style>
		.alert-container {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 1050;
			width: 300px;
		}
		.alert {
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				z-index: 1050;
				width: 350px; /* Adjust as needed */
				text-align: center;
			}
			
	</style>
</head>
<body>
    <div class="section">
        <div class="container">
            <div class="row full-height justify-content-center">
                <div class="col-12 align-self-center ">
                    <div class="section pb-5 pt-5 pt-sm-2 ">
                        <h1 id="kabataan" class="text-center font-weight-bold font-italic">
                            SANGGUNIANG KABATAAN MANAGEMENT SYSTEM
                        </h1>

                        <h6 class="title text-center">
                            <span>Log In</span>
                            <span>Sign Up</span>
                        </h6>

                        <input class="checkbox" type="checkbox" id="reg-log" name="reg-log"/>
                        <label for="reg-log"></label>

                        <div class="card-3d-wrap mx-auto">
                            <div class="card-3d-wrapper">
                                <div class="card-front">
                                    <div class="center-wrap">
                                        <div class="section">
                                            <h4 class="mb-4 pb-3 text-center">
                                                <img src="sk1.png" alt="Logo" class="logo"> Log In
                                            </h4>
                                            <form action="login.php" method="POST">
                                                <div class="form-group">
                                                    <label for="email" class="form-label">Email:</label>
                                                    <i class="input-icon uil uil-at"></i>
                                                    <input type="email" name="email" class="form-style" placeholder="Email" required>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <label for="password">Password:</label>
                                                    <div class="input-group">
                                                        <i class="input-icon uil uil-lock"></i>
                                                        <input type="password" id="login-password" name="password" class="form-style" placeholder="Password" required>
                                                        <div class="input-group-append">
                                                            <span class="input-group-text" onclick="togglePassword('login-password', 'eye-icon-login')">
                                                                <i id="eye-icon-login" class="uil uil-eye"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn mt-4 ">Login</button>
                                            </form>
                                            <p class="mb-0 mt-4 text-center">
                                                <a href="forgot_password.php" class="link">Forgot your password?</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-back">
                                    <div class="center-wrap">
                                        <div class="section">
                                            <h4 class="mb-3 pb-3 text-center">
                                                <img src="sk1.png" alt="Logo" class="logo"> Sign Up
                                            </h4>
                                            <form action="signup.php" method="POST">
                                                <div class="form-group">
                                                    <label for="name">Full Name:</label>
                                                    <i class="input-icon uil uil-user"></i>
                                                    <input type="text" name="full_name" class="form-style" placeholder="Full Name" required>
                                                </div> 
                                                <div class="form-group mt-2">
                                                    <label for="phone">Phone Number:</label>
                                                    <i class="input-icon uil uil-phone"></i>
                                                    <input type="tel" name="phone" class="form-style" placeholder="Phone Number" required>
                                                </div> 
                                                <div class="form-group mt-2">
                                                    <label for="email">Email:</label>
                                                    <i class="input-icon uil uil-at"></i>
                                                    <input type="email" name="email" class="form-style" placeholder="Email" required>
                                                </div>
                                                <div class="form-group mt-2">
                                                    <label for="password">Password:</label>
                                                    <div class="input-group">
                                                        <i class="input-icon uil uil-lock"></i>
                                                        <input type="password" id="signup-password" name="password" class="form-style" placeholder="Password" required>
                                                        <div class="input-group-append">
                                                            <span class="input-group-text" onclick="togglePassword('signup-password', 'eye-icon-signup')">
                                                                <i id="eye-icon-signup" class="uil uil-eye"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <!-- <p class="form-text text-muted">Password must be at least 8 characters and contain letters and numbers.</p> -->
                                                </div>
												<div class="form-group mt-2">
													<label for="confirm_password">Confirm Password:</label>
													<div class="input-group">
														<i class="input-icon uil uil-lock"></i>
														<input type="password" id="confirm-password" name="confirm_password" class="form-style" placeholder="Confirm Password" required>
														<div class="input-group-append">
														</div>
													</div>
												</div>
                                                <button type="submit" class="btn mt-4 center">Register</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	

	<div class="alert-container">
		<div id="loginAlert" class="alert alert-danger alert-dismissible fade show" role="alert" style="display:none;">
			Incorrect email or password!
		</div>
		<div id="loginSuccessAlert" class="alert alert-success alert-dismissible fade show" role="alert" style="display:none;">
			Login successful! Welcome back.
		</div>
		<div id="signupAlert" class="alert alert-danger alert-dismissible fade show" role="alert" style="display:none;">
			Registration failed! Please try again.
		</div>
		<div id="signupAlert" class="alert alert-danger alert-dismissible fade show" role="alert" style="display:none;">
			This full name is already in use! Please choose a different name.
		</div>
		<div id="signupAlert" class="alert alert-danger alert-dismissible fade show" role="alert" style="display:none;">
			Password must contain at least one letter, one number, and be at least 8 characters long.
		</div>
		<div id="signupAlert" class="alert alert-danger alert-dismissible fade show" role="alert" style="display:none;">
			Passwords do not match! Please try again.
		</div>
		<div id="signupSuccessAlert" class="alert alert-success alert-dismissible fade show" role="alert" style="display:none;">
			Signup successful!
		</div>

	</div>
	
	
	<script>
		$(document).ready(function () {
			const urlParams = new URLSearchParams(window.location.search);
			const alertType = urlParams.get('alert');
		
			if (alertType === 'signup_success') {
				$('#signupSuccessAlert').fadeIn(500).delay(1000).fadeOut(500);
			} else if (alertType === 'signup_error') {
				$('#signupAlert').fadeIn(500).delay(1000).fadeOut(500);
			} else if (alertType === 'email_in_use') {
				$('#signupAlert').html("Email already in use!").fadeIn(500).delay(1000).fadeOut(500);
			} else if (alertType === 'login_error') {
				$('#loginAlert').fadeIn(500).delay(1000).fadeOut(500);
			}else if (alertType === 'full_name_in_use') {
				$('#signupAlert').html("This full name is already in use! Please choose a different name.")
					.fadeIn(500).delay(3000).fadeOut(500);
			}else if (alertType === 'password_mismatch') {
				$('#signupAlert').html("Passwords do not match! Please try again.")
					.fadeIn(500).delay(3000).fadeOut(500);
			}else if (alertType === 'password_complexity_error') {
				$('#signupAlert').html("Password must contain at least one letter, one number, and be at least 8 characters long.")
					.fadeIn(500).delay(3000).fadeOut(500);
			}
			
			
		if (window.location.search.includes("alert=password_error")) {
        alert("Password must be at least 8 characters and contain only letters and numbers.");
	}
});
	

$(document).ready(function () {
    // Handle form submission via AJAX
    $("form").submit(function (event) {
        event.preventDefault(); // Prevent default form submission

        let form = $(this);
        let url = form.attr("action"); // Get the form's action (login.php or signup.php)

        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (response.status === "success") {
                    // Success handling
                    if (url === "login.php") {
                        // Login success
                        $("#loginSuccessAlert").text(response.message).show();
                        setTimeout(function () {
                            window.location.href = "dashboard.php"; // Redirect to dashboard after login
                        }, 1000);
                    } else if (url === "signup.php") {
                        // Signup success
                        $("#signupSuccessAlert").text(response.message).show();
                        setTimeout(function () {
                            location.reload(); // Refresh after successful signup
                        }, 1500);
                    }
                } else {
                    // Error handling
                    if (url === "login.php") {
                        // Check if it's a blocking message
                        if (response.message.includes("Too many failed attempts")) {
                            // Create a special alert for blocked accounts
                            $("#loginAlert")
                                .html('<strong>Account Temporarily Blocked:</strong> ' + response.message)
                                .removeClass('alert-danger')
                                .addClass('alert-warning')
                                .show();

                            // If there's a countdown timer needed
                            if (response.message.includes("Please try again in")) {
                                startBlockCountdown(response.message);
                            }
                        } else {
                            // Regular login error
                            $("#loginAlert")
                                .text(response.message)
                                .removeClass('alert-warning')
                                .addClass('alert-danger')
                                .show();
                        }
                    } else if (url === "signup.php") {
                        // Signup error
                        $("#signupAlert").text(response.message).show();
                    }

                    // Hide the alert after 5 seconds
                    setTimeout(function () {
                        $(".alert").fadeOut();
                    }, 5000);
                }
            },
            error: function () {
                alert("Something went wrong. Please try again.");
            }
        });
    });
});


// Function to start countdown for blocked accounts
function startBlockCountdown(message) {
    // Extract the remaining minutes from the message
    const minutesMatch = message.match(/(\d+) minute\(s\)/);
    if (!minutesMatch) return;

    let remainingSeconds = parseInt(minutesMatch[1]) * 60;
    const loginBtn = $('form[action="login.php"] button[type="submit"]');
    const originalBtnText = loginBtn.text();

    // Disable the login button
    loginBtn.prop('disabled', true);

    // Update the countdown every second
    const countdownInterval = setInterval(function () {
        remainingSeconds--;

        if (remainingSeconds <= 0) {
            // Re-enable login when countdown completes
            clearInterval(countdownInterval);
            loginBtn.prop('disabled', false).text(originalBtnText);
            $("#loginAlert").fadeOut();
        } else {
            // Calculate minutes and seconds for display
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;

            // Update the button text with countdown
            loginBtn.text(`Try again in ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`);

            // Update the alert message
            $("#loginAlert").html(
                `<strong>Account Temporarily Blocked:</strong> Too many failed attempts. ` +
                `Please try again in ${minutes} minute(s) and ${seconds} second(s).`
            );
        }
    }, 1000);
}


	
	function togglePassword(inputId, iconId) {
		var passwordInput = document.getElementById(inputId);
		var icon = document.getElementById(iconId);
	
		if (passwordInput.type === "password") {
			passwordInput.type = "text";
			icon.classList.remove("uil-eye");
			icon.classList.add("uil-eye-slash");
		} else {
			passwordInput.type = "password";
			icon.classList.remove("uil-eye-slash");
			icon.classList.add("uil-eye");
		}
	}

    document.addEventListener('DOMContentLoaded', function() {
        // Find all password fields
        const passwordFields = document.querySelectorAll('input[type="password"]');
        
        // Create tooltip element
        const tooltip = document.createElement('div');
        tooltip.className = 'password-tooltip';
        tooltip.innerText = 'Not allowed for security reasons';
        tooltip.style.cssText = 'position: absolute; background: #f44336; color: white; padding: 5px 10px; border-radius: 3px; font-size: 12px; z-index: 1000; opacity: 0; transition: opacity 0.3s;';
        document.body.appendChild(tooltip);
        
        // Apply protection to each password field
        passwordFields.forEach(field => {
          // Prevent copy, cut, paste
          ['copy', 'cut', 'paste'].forEach(function(event) {
            field.addEventListener(event, function(e) {
              e.preventDefault();
              
              // Show tooltip near the field
              const rect = field.getBoundingClientRect();
              tooltip.style.left = rect.left + 'px';
              tooltip.style.top = (rect.bottom + 5) + 'px';
              tooltip.style.opacity = '1';
              
              // Hide tooltip after 2 seconds
              setTimeout(function() {
                tooltip.style.opacity = '0';
              }, 2000);
            });
          });
          
          // Prevent right-click
          field.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
          });
        });
      });

		
	</script>
</body>
</html>
